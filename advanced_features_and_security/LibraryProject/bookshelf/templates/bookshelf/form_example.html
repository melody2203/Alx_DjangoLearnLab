<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Examples - Security Best Practices</title>
    <!-- Bootstrap CSS for better styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .security-note {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-bottom: 20px;
        }
        .security-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
        }
        .form-section {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: #fff;
        }
        .code-example {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">Form Examples - Security Best Practices</h1>
                
                <!-- Security Introduction -->
                <div class="security-note">
                    <h5>🔒 Security Features Implemented:</h5>
                    <ul class="mb-0">
                        <li><strong>CSRF Protection:</strong> All forms include CSRF tokens</li>
                        <li><strong>XSS Prevention:</strong> Input sanitization and auto-escaping</li>
                        <li><strong>SQL Injection Prevention:</strong> Using Django ORM</li>
                        <li><strong>Input Validation:</strong> Server-side and client-side validation</li>
                        <li><strong>Content Security Policy:</strong> Restricted resource loading</li>
                    </ul>
                </div>

                <!-- Example 1: BookForm (ModelForm) -->
                <div class="form-section">
                    <h2>1. Book Form (ModelForm)</h2>
                    <p class="text-muted">Example of a ModelForm with built-in validation and security.</p>
                    
                    <div class="security-warning">
                        <strong>Security Note:</strong> This form uses Django's ModelForm which automatically:
                        <ul class="mb-0">
                            <li>Validates data types</li>
                            <li>Enforces model constraints</li>
                            <li>Prevents mass assignment vulnerabilities</li>
                        </ul>
                    </div>

                    <form method="post" action="{% url 'bookshelf:book_create' %}">
                        {% csrf_token %}  <!-- CSRF Protection -->
                        
                        <!-- Method 1: Automatic form rendering -->
                        <div class="mb-3">
                            <h5>Automatic Rendering:</h5>
                            {{ book_form.as_p }}
                        </div>

                        <hr>

                        <!-- Method 2: Manual form rendering with custom styling -->
                        <h5>Manual Rendering with Validation:</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ book_form.title.id_for_label }}" class="form-label">
                                    {{ book_form.title.label }} *
                                </label>
                                {{ book_form.title }}
                                {% if book_form.title.errors %}
                                    <div class="text-danger small">
                                        {% for error in book_form.title.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if book_form.title.help_text %}
                                    <div class="form-text">{{ book_form.title.help_text }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="{{ book_form.author.id_for_label }}" class="form-label">
                                    {{ book_form.author.label }} *
                                </label>
                                {{ book_form.author }}
                                {% if book_form.author.errors %}
                                    <div class="text-danger small">
                                        {% for error in book_form.author.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if book_form.author.help_text %}
                                    <div class="form-text">{{ book_form.author.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ book_form.publication_year.id_for_label }}" class="form-label">
                                    {{ book_form.publication_year.label }} *
                                </label>
                                {{ book_form.publication_year }}
                                {% if book_form.publication_year.errors %}
                                    <div class="text-danger small">
                                        {% for error in book_form.publication_year.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if book_form.publication_year.help_text %}
                                    <div class="form-text">{{ book_form.publication_year.help_text }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="form-check mt-4">
                                    {{ book_form.is_public }}
                                    <label for="{{ book_form.is_public.id_for_label }}" class="form-check-label">
                                        {{ book_form.is_public.label }}
                                    </label>
                                    {% if book_form.is_public.errors %}
                                        <div class="text-danger small">
                                            {% for error in book_form.is_public.errors %}
                                                {{ error }}<br>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Create Book</button>
                        <a href="{% url 'bookshelf:book_list' %}" class="btn btn-secondary">Cancel</a>
                    </form>

                    <div class="code-example mt-3">
                        <strong>Template Code:</strong><br>
                        &lt;form method="post"&gt;<br>
                        &nbsp;&nbsp;{% raw %}{% csrf_token %}{% endraw %}<br>
                        &nbsp;&nbsp;{{ form.as_p }}<br>
                        &lt;/form&gt;
                    </div>
                </div>

                <!-- Example 2: Search Form -->
                <div class="form-section">
                    <h2>2. Search Form (Regular Form)</h2>
                    <p class="text-muted">Example of a search form with GET method and input sanitization.</p>

                    <form method="get" action="{% url 'bookshelf:search_books' %}">
                        <!-- No CSRF token needed for GET forms -->
                        
                        <div class="row g-3 align-items-end">
                            <div class="col-md-6">
                                <label for="{{ search_form.query.id_for_label }}" class="form-label">
                                    {{ search_form.query.label }}
                                </label>
                                {{ search_form.query }}
                                {% if search_form.query.help_text %}
                                    <div class="form-text">{{ search_form.query.help_text }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-3">
                                <label for="{{ search_form.publication_year.id_for_label }}" class="form-label">
                                    {{ search_form.publication_year.label }}
                                </label>
                                {{ search_form.publication_year }}
                            </div>

                            <div class="col-md-3">
                                <button type="submit" class="btn btn-success w-100">Search</button>
                            </div>
                        </div>

                        <!-- Radio buttons for search type -->
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">{{ search_form.search_type.label }}</label>
                                <div class="d-flex gap-3">
                                    {% for choice in search_form.search_type %}
                                        <div class="form-check">
                                            {{ choice.tag }}
                                            <label for="{{ choice.id_for_label }}" class="form-check-label">
                                                {{ choice.choice_label }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="code-example mt-3">
                        <strong>Security Feature:</strong> GET forms don't need CSRF tokens, but input is still sanitized in the view.
                    </div>
                </div>

                <!-- Example 3: User Registration Form -->
                <div class="form-section">
                    <h2>3. User Registration Form</h2>
                    <p class="text-muted">Example of a multi-field form with cross-field validation.</p>

                    <form method="post" action="#">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ registration_form.email.id_for_label }}" class="form-label">
                                    {{ registration_form.email.label }} *
                                </label>
                                {{ registration_form.email }}
                                {% if registration_form.email.errors %}
                                    <div class="text-danger small">
                                        {% for error in registration_form.email.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="{{ registration_form.date_of_birth.id_for_label }}" class="form-label">
                                    {{ registration_form.date_of_birth.label }}
                                </label>
                                {{ registration_form.date_of_birth }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ registration_form.password.id_for_label }}" class="form-label">
                                    {{ registration_form.password.label }} *
                                </label>
                                {{ registration_form.password }}
                                {% if registration_form.password.errors %}
                                    <div class="text-danger small">
                                        {% for error in registration_form.password.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <div class="form-text">Minimum 8 characters, not entirely numeric.</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="{{ registration_form.password_confirm.id_for_label }}" class="form-label">
                                    {{ registration_form.password_confirm.label }} *
                                </label>
                                {{ registration_form.password_confirm }}
                                {% if registration_form.password_confirm.errors %}
                                    <div class="text-danger small">
                                        {% for error in registration_form.password_confirm.errors %}
                                            {{ error }}<br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Register</button>
                    </form>

                    <div class="code-example mt-3">
                        <strong>Security Features:</strong><br>
                        - Password strength validation<br>
                        - Cross-field validation (password confirmation)<br>
                        - Email sanitization<br>
                        - CSRF protection
                    </div>
                </div>

                <!-- Example 4: Contact Form -->
                <div class="form-section">
                    <h2>4. Contact Form</h2>
                    <p class="text-muted">Example with textarea and selective HTML allowance.</p>

                    <form method="post" action="#">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ contact_form.name.id_for_label }}" class="form-label">
                                    {{ contact_form.name.label }} *
                                </label>
                                {{ contact_form.name }}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="{{ contact_form.email.id_for_label }}" class="form-label">
                                    {{ contact_form.email.label }} *
                                </label>
                                {{ contact_form.email }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ contact_form.subject.id_for_label }}" class="form-label">
                                {{ contact_form.subject.label }} *
                            </label>
                            {{ contact_form.subject }}
                        </div>

                        <div class="mb-3">
                            <label for="{{ contact_form.priority.id_for_label }}" class="form-label">
                                {{ contact_form.priority.label }}
                            </label>
                            {{ contact_form.priority }}
                        </div>

                        <div class="mb-3">
                            <label for="{{ contact_form.message.id_for_label }}" class="form-label">
                                {{ contact_form.message.label }} *
                            </label>
                            {{ contact_form.message }}
                            {% if contact_form.message.help_text %}
                                <div class="form-text">{{ contact_form.message.help_text }}</div>
                            {% endif %}
                            <div class="form-text">
                                <strong>Allowed formatting:</strong> &lt;b&gt;, &lt;i&gt;, &lt;em&gt;, &lt;strong&gt;, &lt;p&gt;, &lt;br&gt;, &lt;ul&gt;, &lt;ol&gt;, &lt;li&gt;
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>

                    <div class="code-example mt-3">
                        <strong>Security Feature:</strong> Limited HTML tags allowed in message field to prevent XSS while allowing basic formatting.
                    </div>
                </div>

                <!-- Security Best Practices Summary -->
                <div class="form-section bg-light">
                    <h2>Security Best Practices Summary</h2>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>✅ Always Do:</h5>
                            <ul>
                                <li>Use <code>{% raw %}{% csrf_token %}{% endraw %}</code> in POST forms</li>
                                <li>Sanitize user input with <code>strip_tags()</code> and <code>html.escape()</code></li>
                                <li>Use Django's built-in form validation</li>
                                <li>Validate file uploads (type, size)</li>
                                <li>Use HTTPS in production</li>
                                <li>Implement proper error handling</li>
                            </ul>
                        </div>
                        
                        <div class="col-md-6">
                            <h5>❌ Never Do:</h5>
                            <ul>
                                <li>Use <code>|safe</code> filter on user input</li>
                                <li>Build SQL queries with string formatting</li>
                                <li>Trust client-side validation alone</li>
                                <li>Store passwords in plain text</li>
                                <li>Expose sensitive information in error messages</li>
                                <li>Allow unlimited file uploads</li>
                            </ul>
                        </div>
                    </div>

                    <div class="code-example">
                        <strong>Example of Secure Input Sanitization:</strong><br>
                        from django.utils.html import strip_tags<br>
                        import html<br><br>
                        def clean_user_input(input_text):<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;# Remove HTML tags<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;clean_text = strip_tags(input_text)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;# Escape HTML entities<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;clean_text = html.escape(clean_text)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;return clean_text
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Client-side validation example -->
    <script>
        // Example of client-side validation (complementary to server-side)
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    // Basic client-side validation
                    const requiredFields = form.querySelectorAll('[required]');
                    let isValid = true;
                    
                    requiredFields.forEach(field => {
                        if (!field.value.trim()) {
                            isValid = false;
                            field.classList.add('is-invalid');
                        } else {
                            field.classList.remove('is-invalid');
                        }
                    });
                    
                    if (!isValid) {
                        e.preventDefault();
                        alert('Please fill in all required fields.');
                    }
                });
            });
        });
    </script>
</body>
</html>